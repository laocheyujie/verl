# 自定义奖励

## 接口规范

```py
def custom_reward_fn(data_source, solution_str, ground_truth, extra_info=None):
    """自定义奖励函数模板

    参数:
        data_source: 数据集标识符
        solution_str: 模型生成的解答
        ground_truth: 标准答案
        extra_info: 额外信息字典

    返回:
        float: 评分结果
    """
    # 实现自定义评分逻辑
    return score
```

## 配置方式

```yaml
custom_reward_function:
  path: "path/to/your/reward_module.py"
  name: "custom_reward_fn" # 可选，默认为compute_score
```

## 沙箱融合评估

```py
# 代码评测示例
res = sandbox_fusion.compute_score(
    sandbox_fusion_url,
    concurrent_semaphore,
    memory_limit_mb,
    solution_str,
    ground_truth,  # 包含测试用例
    continuous=True
)
```

- `concurrent_semaphore`: 通过 concurrent_semaphore 参数控制并发请求，避免资源竞争和过载
- `memory_limit_mb`: 设置 memory_limit_mb 参数，确保代码执行不会耗尽系统资源

## Math-Verify 工具

```py
# 启用Math-Verify增强评估
from . import math_verify
res = math_verify.compute_score(solution_str, ground_truth)
```

## 答案提取优化

```py
# 优化长文本处理
_SOLUTION_CLIP_CHARS = 300

def extract_solution(solution_str, method="strict"):
    # 仅匹配最后 300 字符，提高正则效率
    if len(solution_str) > _SOLUTION_CLIP_CHARS:
        solution_str = solution_str[-_SOLUTION_CLIP_CHARS:]
    # ... 后续处理
```
